<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeMetrics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        charcoal: {
                            50: '#f6f7f9',
                            100: '#eceef2',
                            200: '#d4d9e2',
                            300: '#b0bac9',
                            400: '#8694ab',
                            500: '#677591',
                            600: '#525e78',
                            700: '#434d62',
                            800: '#3a4253',
                            900: '#343a47',
                            950: '#1a1d24'
                        },
                        navy: {
                            50: '#f0f4ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b'
                        },
                        gold: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                            950: '#451a03'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(99, 102, 241, 0.3)' },
                            '100%': { boxShadow: '0 0 20px rgba(99, 102, 241, 0.6)' }
                        }
                    },
                    backdropBlur: {
                        xs: '2px'
                    }
                }
            }
        }
    </script>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRWRnZU1ldHJpY3MiLCJzaG9ydF9uYW1lIjoiRWRnZU1ldHJpY3MiLCJkZXNjcmlwdGlvbiI6IlByb2Zlc3Npb25hbCB0cmFkaW5nIGFuYWx5dGljcyBwbGF0Zm9ybSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGYxNzJhIiwidGhlbWVfY29sb3IiOiIjMzczM2ZmIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGREYjNnOUlqQWdNQ0EwT0RnZ05EZzRJajQ4Y21WamRDQjRQU0l4TWpnaUlIazlJakV5T0NJaUlIZHBaSFJvVFRJeU5ESWlJR2hsYVdkb2REMGlNalF5SWlCbWFXeHNQU0lqTXpjek0yWm1JaUJ5ZUQwaU1USWlMejQ4TDNOMlp6ND0iLCJzaXplcyI6IjQ4NHg0ODQiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <meta name="theme-color" content="#3733ff">
    <style>
        /* Premium Design System */
        :root {
            --glass-bg: rgba(26, 29, 36, 0.8);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-large: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-aurora: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-sunset: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-ocean: linear-gradient(135deg, #667db6 0%, #0082c8 100%);
        }

        /* Advanced Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }

        @keyframes slideInLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes countUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: var(--progress-width); }
        }

        /* Micro-interactions */
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-breathe { animation: breathe 4s ease-in-out infinite; }
        .animate-slide-in-left { animation: slideInLeft 0.6s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.6s ease-out; }
        .animate-count-up { animation: countUp 0.8s ease-out; }

        /* Enhanced Glass Morphism */
        .glass-premium {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        /* Interactive Elements */
        .ripple-effect {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple-effect:active::before {
            width: 300px;
            height: 300px;
        }

        /* Smart Hover States */
        .smart-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .smart-hover::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(79,70,229,0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .smart-hover:hover::after {
            opacity: 1;
        }

        .smart-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        /* Progress Indicators */
        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 4px;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Enhanced Typography */
        .text-gradient-aurora { 
            background: var(--gradient-aurora); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .text-gradient-sunset { 
            background: var(--gradient-sunset); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .text-gradient-ocean { 
            background: var(--gradient-ocean); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        /* Status Indicators */
        .status-indicator {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .status-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-online::before { background: #10b981; }
        .status-warning::before { background: #f59e0b; }
        .status-error::before { background: #ef4444; }

        /* Data Visualization Enhancements */
        .chart-container {
            position: relative;
            background: linear-gradient(135deg, rgba(99,102,241,0.05), rgba(79,70,229,0.05));
            border-radius: 16px;
            padding: 20px;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99,102,241,0.5), transparent);
        }

        /* Enhanced Form Elements */
        .form-floating {
            position: relative;
        }

        .form-floating input:focus + label,
        .form-floating input:not(:placeholder-shown) + label {
            transform: translateY(-1.5rem) scale(0.85);
            color: #6366f1;
            font-weight: 500;
        }

        .form-floating label {
            position: absolute;
            left: 0.75rem;
            top: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            color: #8694ab;
            font-weight: 400;
        }

        .form-floating input {
            background: rgba(26, 29, 36, 0.6);
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .form-floating input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
            background: rgba(26, 29, 36, 0.8);
        }

        /* Smart Loading States */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Enhanced Tooltips */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Performance Optimizations */
        .gpu-accelerated {
            transform: translateZ(0);
            will-change: transform;
        }

        /* Dark Mode Enhancements */
        .dark-mode-toggle {
            background: linear-gradient(135deg, #1a1d24, #343a47);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            padding: 4px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle::before {
            content: '';
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gradient-primary);
            transition: transform 0.3s ease;
        }

        /* Responsive Enhancements */
        @media (max-width: 768px) {
            .smart-hover:hover {
                transform: none;
            }
            
            .animate-float {
                animation: none;
            }
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus Indicators */
        .focus-ring:focus {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
            border-radius: 8px;
        }

        /* Enhanced Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(26, 29, 36, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #525e78, #434d62);
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #677591, #525e78);
        }

        /* Typography */
        .font-display { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .text-gradient { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Glass Morphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        /* Premium Buttons */
        .btn-primary {
            background: var(--gradient-primary);
            transition: all 0.2s ease;
            transform: translateY(0);
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }
        .btn-primary:active {
            transform: translateY(0);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1d24; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, #525e78, #434d62);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #677591, #525e78); }

        /* Form Enhancements */
        .floating-label {
            position: relative;
        }
        .floating-label input:focus + label,
        .floating-label input:not(:placeholder-shown) + label {
            transform: translateY(-1.5rem) scale(0.85);
            color: #6366f1;
        }
        .floating-label label {
            position: absolute;
            left: 0.75rem;
            top: 0.75rem;
            transition: all 0.2s ease;
            pointer-events: none;
            color: #8694ab;
        }

        /* Mood Slider */
        .mood-slider {
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            height: 8px;
            border-radius: 4px;
        }
        .mood-slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: 3px solid #6366f1;
        }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-large);
        }

        /* Table Enhancements */
        .table-row {
            transition: all 0.2s ease;
        }
        .table-row:hover {
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.001);
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Accessibility */
        .focus-visible:focus {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .glass { backdrop-filter: blur(10px); }
            .card-hover:hover { transform: none; }
        }

        /* Performance Optimizations */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .will-change-transform { will-change: transform; }
        .will-change-opacity { will-change: opacity; }
    </style>
</head>
<body class="dark bg-charcoal-950 text-white min-h-screen font-display antialiased">
    <!-- Authentication Screen -->
    <div id="auth-screen" class="min-h-screen bg-gradient-to-br from-charcoal-950 via-navy-950 to-charcoal-900 flex items-center justify-center p-4 animate-fade-in" style="display: none;">
        <div class="max-w-md w-full space-y-8 animate-slide-up">
            <div class="text-center">
                <div class="w-16 h-16 glass rounded-2xl flex items-center justify-center mx-auto mb-6 animate-glow">
                    <i data-lucide="trending-up" class="w-8 h-8 text-gold-400"></i>
                </div>
                <h2 class="text-4xl font-bold text-gradient mb-2">EdgeMetrics</h2>
                <p class="text-charcoal-300">Professional trading analytics platform</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="glass rounded-2xl p-8 shadow-2xl animate-scale-in">
                <form id="login-form-element" class="space-y-6">
                    <div class="floating-label">
                        <input type="email" name="email" required class="w-full bg-charcoal-800/50 border border-charcoal-600 rounded-xl px-4 py-4 text-white focus:outline-none focus:ring-2 focus:ring-navy-500 focus:border-transparent transition-all duration-200" placeholder=" ">
                        <label class="text-sm font-medium text-charcoal-300">Email Address</label>
                    </div>
                    <div class="floating-label">
                        <input type="password" name="password" required class="w-full bg-charcoal-800/50 border border-charcoal-600 rounded-xl px-4 py-4 text-white focus:outline-none focus:ring-2 focus:ring-navy-500 focus:border-transparent transition-all duration-200" placeholder=" ">
                        <label class="text-sm font-medium text-charcoal-300">Password</label>
                    </div>
                    <div id="login-error" class="text-red-400 text-sm hidden bg-red-500/10 border border-red-500/20 rounded-lg p-3"></div>
                    <button type="submit" class="w-full btn-primary text-white font-semibold py-4 px-6 rounded-xl focus-visible:focus will-change-transform">
                        <span class="flex items-center justify-center space-x-2">
                            <i data-lucide="log-in" class="w-5 h-5"></i>
                            <span>Sign In</span>
                        </span>
                    </button>
                </form>

                <div class="mt-6">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-dark-600"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-dark-800 text-gray-400">Or continue with</span>
                        </div>
                    </div>

                    <button id="google-login-btn" class="mt-4 w-full bg-white hover:bg-gray-50 text-gray-900 font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span>Sign in with Google</span>
                    </button>
                </div>

                <div class="mt-6 text-center">
                    <p class="text-gray-400">Don't have an account? 
                        <button id="show-signup-btn" class="text-indigo-400 hover:text-indigo-300 font-medium">Sign up</button>
                    </p>
                </div>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="bg-dark-800 rounded-xl p-8 border border-dark-700 hidden">
                <form id="signup-form-element" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                        <input type="text" name="name" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your full name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                        <input type="email" name="email" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your email">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                        <input type="password" name="password" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Create a password (min 6 characters)">
                    </div>
                    <div id="signup-error" class="text-red-400 text-sm hidden"></div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        Create Account
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-gray-400">Already have an account? 
                        <button id="show-login-btn" class="text-indigo-400 hover:text-indigo-300 font-medium">Sign in</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 glass border-r border-charcoal-700/50 flex flex-col transition-all duration-300 ease-in-out lg:translate-x-0 -translate-x-full fixed lg:relative z-30 h-full will-change-transform">
            <!-- Logo -->
            <div class="p-6 border-b border-charcoal-700/50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-navy-500 to-navy-700 rounded-xl flex items-center justify-center shadow-lg">
                        <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gradient">EdgeMetrics</h1>
                        <p class="text-xs text-charcoal-400">Pro Analytics</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-2">
                <a href="#dashboard" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 active smart-hover ripple-effect focus-ring" data-route="dashboard">
                    <div class="relative">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Dashboard</span>
                    <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <div class="w-2 h-2 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"></div>
                    </div>
                </a>
                
                <a href="#journal" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="journal">
                    <div class="relative">
                        <i data-lucide="book-open" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-green-500 to-blue-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Journal</span>
                    <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <div class="w-2 h-2 bg-gradient-to-r from-green-400 to-blue-400 rounded-full"></div>
                    </div>
                </a>
                
                <a href="#analytics" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="analytics">
                    <div class="relative">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Analytics</span>
                    <div class="ml-auto">
                        <div class="px-2 py-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full text-xs font-bold text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">PRO</div>
                    </div>
                </a>
                
                <a href="#tools" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="tools">
                    <div class="relative">
                        <i data-lucide="calculator" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Tools</span>
                    <div class="ml-auto">
                        <div class="px-2 py-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full text-xs font-bold text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">PRO</div>
                    </div>
                </a>
                
                <a href="#psychology" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="psychology">
                    <div class="relative">
                        <i data-lucide="brain" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Psychology</span>
                    <div class="ml-auto">
                        <div class="px-2 py-1 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full text-xs font-bold text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">TEAM</div>
                    </div>
                </a>
                
                <a href="#playbook" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="playbook">
                    <div class="relative">
                        <i data-lucide="book" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Playbook</span>
                    <div class="ml-auto">
                        <div class="px-2 py-1 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full text-xs font-bold text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">TEAM</div>
                    </div>
                </a>
                
                <div class="border-t border-charcoal-700/50 my-4"></div>
                
                <a href="#settings" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="settings">
                    <div class="relative">
                        <i data-lucide="settings" class="w-5 h-5 group-hover:scale-110 group-hover:rotate-90 transition-all duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-gray-500 to-slate-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Settings</span>
                </a>
                
                <a href="#payments" class="nav-link group flex items-center space-x-3 px-4 py-3 rounded-xl text-charcoal-300 hover:bg-navy-500/20 hover:text-white transition-all duration-300 smart-hover ripple-effect focus-ring" data-route="payments">
                    <div class="relative">
                        <i data-lucide="credit-card" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                        <div class="absolute -inset-1 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    </div>
                    <span class="font-medium">Payments</span>
                    <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <div class="w-2 h-2 bg-gradient-to-r from-yellow-400 to-orange-400 rounded-full animate-pulse"></div>
                    </div>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="glass border-b border-charcoal-700/50 px-6 py-4 flex items-center justify-between backdrop-blur-xl">
                <div class="flex items-center space-x-4">
                    <button id="sidebar-toggle" class="lg:hidden p-2 rounded-xl hover:bg-charcoal-700/50 transition-all duration-200 will-change-transform">
                        <i data-lucide="menu" class="w-6 h-6 text-charcoal-300"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <h2 id="page-title" class="text-2xl font-bold text-white">Dashboard</h2>
                        <div class="hidden sm:flex items-center space-x-2 px-3 py-1 bg-gold-500/20 rounded-full">
                            <i data-lucide="crown" class="w-4 h-4 text-gold-400"></i>
                            <span class="text-xs font-medium text-gold-400">PRO</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="notifications-btn" class="p-2 rounded-xl hover:bg-charcoal-700/50 transition-all duration-200 text-charcoal-400 hover:text-white will-change-transform relative" title="Notifications">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span id="notification-badge" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full text-xs hidden"></span>
                    </button>
                    <button id="logout-btn" class="p-2 rounded-xl hover:bg-charcoal-700/50 transition-all duration-200 text-charcoal-400 hover:text-white will-change-transform" title="Logout">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                    <div class="w-10 h-10 bg-gradient-to-br from-navy-500 to-navy-700 rounded-xl flex items-center justify-center shadow-lg ring-2 ring-navy-500/20">
                        <span class="text-sm font-bold text-white">TJ</span>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main id="main-content" class="flex-1 overflow-auto p-6 bg-gradient-to-br from-charcoal-950 via-charcoal-900 to-navy-950">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="page-content">
                    <div class="max-w-7xl mx-auto">
                        <div class="mb-8">
                            <h1 class="text-3xl font-bold mb-2">Welcome to your Trading Journal</h1>
                            <p class="text-gray-400">Track your trades, analyze performance, and improve your trading strategy.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="glass-premium rounded-2xl p-6 smart-hover gpu-accelerated animate-slide-up ripple-effect" style="animation-delay: 0.1s">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-semibold text-charcoal-300 uppercase tracking-wide">Total Trades</h3>
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg animate-float">
                                        <i data-lucide="activity" class="w-6 h-6 text-white"></i>
                                    </div>
                                </div>
                                <p id="total-trades-counter" class="text-4xl font-bold text-gradient-aurora mb-2 animate-count-up">0</p>
                                <div class="flex items-center space-x-2">
                                    <div class="progress-bar w-16 h-1"></div>
                                    <p class="text-xs text-charcoal-400 status-indicator status-online">+0 this week</p>
                                </div>
                            </div>
                            
                            <div class="glass-premium rounded-2xl p-6 smart-hover gpu-accelerated animate-slide-up ripple-effect" style="animation-delay: 0.2s">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-semibold text-charcoal-300 uppercase tracking-wide">Win Rate</h3>
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg animate-breathe">
                                        <i data-lucide="target" class="w-6 h-6 text-white"></i>
                                    </div>
                                </div>
                                <p id="win-rate-counter" class="text-4xl font-bold text-gradient-sunset mb-2 animate-count-up">0%</p>
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 h-1 bg-charcoal-700 rounded-full overflow-hidden">
                                        <div id="win-rate-progress" class="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs text-charcoal-400">Performance</p>
                                </div>
                            </div>
                            
                            <div class="glass-premium rounded-2xl p-6 smart-hover gpu-accelerated animate-slide-up ripple-effect" style="animation-delay: 0.3s">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-semibold text-charcoal-300 uppercase tracking-wide">Total P&L</h3>
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg animate-float" style="animation-delay: 2s">
                                        <i data-lucide="dollar-sign" class="w-6 h-6 text-white"></i>
                                    </div>
                                </div>
                                <p id="pnl-counter" class="text-4xl font-bold text-gradient-ocean mb-2 animate-count-up">$0.00</p>
                                <div class="flex items-center justify-between">
                                    <p id="pnl-status" class="text-xs text-charcoal-400 status-indicator">0% return</p>
                                    <div class="tooltip" data-tooltip="Profit & Loss Overview">
                                        <i data-lucide="info" class="w-4 h-4 text-charcoal-500"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-premium rounded-2xl p-6 smart-hover gpu-accelerated animate-slide-up ripple-effect" style="animation-delay: 0.4s">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-semibold text-charcoal-300 uppercase tracking-wide">Best Trade</h3>
                                    <div class="w-12 h-12 bg-gradient-to-br from-gold-500 to-gold-600 rounded-xl flex items-center justify-center shadow-lg animate-breathe" style="animation-delay: 1s">
                                        <i data-lucide="trophy" class="w-6 h-6 text-white"></i>
                                    </div>
                                </div>
                                <p id="best-trade-counter" class="text-4xl font-bold text-gradient-sunset mb-2 animate-count-up">$0.00</p>
                                <div class="flex items-center justify-between">
                                    <p class="text-xs text-charcoal-400">Peak performance</p>
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-gold-400 to-gold-600 flex items-center justify-center">
                                        <i data-lucide="star" class="w-3 h-3 text-white"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                            <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                            <div class="text-center py-12 text-gray-400">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 102 0V3h4v1a1 1 0 102 0V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5z" clip-rule="evenodd"/>
                                </svg>
                                <p>No trades recorded yet</p>
                                <p class="text-sm mt-1">Start by adding your first trade in the Journal section</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Journal Content -->
                <div id="journal-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-3xl font-bold">Trading Journal</h1>
                            <button id="add-trade-btn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                Add Trade
                            </button>
                        </div>

                        <!-- Trade Input Form -->
                        <div id="trade-form" class="glass-premium rounded-2xl p-8 mb-8 hidden animate-slide-down">
                            <div class="flex items-center justify-between mb-8">
                                <h2 class="text-2xl font-bold text-gradient-aurora">Add New Trade</h2>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-sm text-charcoal-400">Form Active</span>
                                </div>
                            </div>
                            <form id="trade-form-element" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="form-floating">
                                    <input type="text" name="instrument" required class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Instrument (e.g., EURUSD)</label>
                                </div>
                                <div class="form-floating">
                                    <input type="number" name="entry" step="0.00001" required class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Entry Price</label>
                                </div>
                                <div class="form-floating">
                                    <input type="number" name="exit" step="0.00001" class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Exit Price (Optional)</label>
                                </div>
                                <div class="form-floating">
                                    <input type="number" name="stopLoss" step="0.00001" class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-red-500 focus:ring-4 focus:ring-red-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Stop Loss</label>
                                </div>
                                <div class="form-floating">
                                    <input type="number" name="takeProfit" step="0.00001" class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-green-500 focus:ring-4 focus:ring-green-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Take Profit</label>
                                </div>
                                <div class="form-floating">
                                    <input type="number" name="lotSize" step="0.01" required class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Lot Size</label>
                                </div>
                                <div class="relative">
                                    <select name="account" required class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover appearance-none">
                                        <option value="">Select Account Type</option>
                                        <option value="demo">üìä Demo Account</option>
                                        <option value="live">üí∞ Live Account</option>
                                        <option value="prop">üè¢ Prop Firm</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-charcoal-400 pointer-events-none"></i>
                                </div>
                                <div class="form-floating">
                                    <input type="text" name="tags" class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover" placeholder=" ">
                                    <label class="text-sm font-medium text-charcoal-400">Tags (scalp, breakout, etc.)</label>
                                </div>
                                <div class="md:col-span-2 lg:col-span-3">
                                    <div class="relative">
                                        <textarea name="notes" rows="4" class="w-full bg-charcoal-800/60 border-2 border-charcoal-600/50 rounded-xl px-4 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all duration-300 smart-hover resize-none" placeholder="Trade analysis, market conditions, emotions, lessons learned..."></textarea>
                                        <div class="absolute bottom-3 right-3 text-xs text-charcoal-500">
                                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="md:col-span-2 lg:col-span-3 flex justify-end space-x-4 pt-4">
                                    <button type="button" id="cancel-trade-btn" class="px-8 py-3 border-2 border-charcoal-600/50 rounded-xl text-charcoal-300 hover:bg-charcoal-700/50 hover:border-charcoal-500 transition-all duration-300 smart-hover ripple-effect font-medium">
                                        <i data-lucide="x" class="w-4 h-4 inline mr-2"></i>
                                        Cancel
                                    </button>
                                    <button type="submit" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-xl text-white font-semibold transition-all duration-300 smart-hover ripple-effect shadow-lg">
                                        <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                                        Save Trade
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Trades Table -->
                        <div class="glass-premium rounded-2xl overflow-hidden animate-slide-up">
                            <div class="px-8 py-6 border-b border-charcoal-700/50 bg-gradient-to-r from-charcoal-800/50 to-charcoal-700/50">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-2xl font-bold text-gradient-ocean">Trade History</h2>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                            <span class="text-sm text-charcoal-400">Live Data</span>
                                        </div>
                                        <div class="tooltip" data-tooltip="Export trades">
                                            <button class="p-2 rounded-lg hover:bg-charcoal-700/50 transition-colors">
                                                <i data-lucide="download" class="w-4 h-4 text-charcoal-400"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gradient-to-r from-charcoal-800/80 to-charcoal-700/80">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider smart-hover">
                                                <div class="flex items-center space-x-2">
                                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                                    <span>Date</span>
                                                </div>
                                            </th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider smart-hover">
                                                <div class="flex items-center space-x-2">
                                                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                                                    <span>Instrument</span>
                                                </div>
                                            </th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider">Entry</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider">Exit</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider">Size</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider smart-hover">
                                                <div class="flex items-center space-x-2">
                                                    <i data-lucide="dollar-sign" class="w-4 h-4"></i>
                                                    <span>P&L</span>
                                                </div>
                                            </th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider">Account</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-charcoal-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trades-table-body" class="divide-y divide-charcoal-700/30">
                                        <tr id="no-trades-row" class="animate-fade-in">
                                            <td colspan="8" class="px-6 py-16 text-center">
                                                <div class="flex flex-col items-center space-y-4">
                                                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center animate-breathe">
                                                        <i data-lucide="plus-circle" class="w-10 h-10 text-indigo-400"></i>
                                                    </div>
                                                    <div class="text-center">
                                                        <p class="text-lg font-semibold text-charcoal-300 mb-2">Ready to start trading?</p>
                                                        <p class="text-sm text-charcoal-500 mb-4">Click "Add Trade" to record your first trade and begin your journey</p>
                                                        <button onclick="document.getElementById('add-trade-btn').click()" class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-xl text-white font-medium transition-all duration-300 smart-hover ripple-effect">
                                                            <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                                                            Add Your First Trade
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Content -->
                <div id="analytics-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8">Analytics</h1>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <!-- Profit by Instrument Chart -->
                            <div class="glass-premium rounded-2xl p-6 smart-hover chart-container animate-slide-in-left">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-xl font-semibold text-gradient-aurora">Profit by Instrument</h2>
                                    <div class="tooltip" data-tooltip="Click bars for details">
                                        <i data-lucide="info" class="w-4 h-4 text-charcoal-500"></i>
                                    </div>
                                </div>
                                <div id="profit-by-instrument" class="h-64 flex items-center justify-center text-gray-400">
                                    <div class="text-center animate-fade-in">
                                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center">
                                            <i data-lucide="bar-chart-3" class="w-8 h-8 text-purple-400"></i>
                                        </div>
                                        <p class="text-charcoal-300 font-medium">No trading data yet</p>
                                        <p class="text-sm text-charcoal-500 mt-1">Add trades to see instrument performance</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Win/Loss Over Time Chart -->
                            <div class="glass-premium rounded-2xl p-6 smart-hover chart-container animate-slide-in-right">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-xl font-semibold text-gradient-sunset">Performance Timeline</h2>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                        <span class="text-xs text-charcoal-400">Live</span>
                                    </div>
                                </div>
                                <div id="win-loss-chart" class="h-64 flex items-center justify-center text-gray-400">
                                    <div class="text-center animate-fade-in">
                                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center">
                                            <i data-lucide="trending-up" class="w-8 h-8 text-blue-400"></i>
                                        </div>
                                        <p class="text-charcoal-300 font-medium">Track your progress</p>
                                        <p class="text-sm text-charcoal-500 mt-1">Performance chart will appear here</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk-Reward Ratio -->
                        <div class="bg-dark-800 rounded-xl p-6 border border-dark-700 mb-8">
                            <h2 class="text-xl font-semibold mb-4">Average Risk-Reward Ratio</h2>
                            <div id="rrr-display" class="text-center py-8">
                                <div class="text-4xl font-bold text-indigo-400 mb-2">0:0</div>
                                <p class="text-gray-400">Average Risk-Reward Ratio</p>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h3 class="text-lg font-semibold mb-4">Best Performing Pair</h3>
                                <div id="best-pair" class="text-center">
                                    <div class="text-2xl font-bold text-green-400 mb-1">-</div>
                                    <p class="text-sm text-gray-400">No trades yet</p>
                                </div>
                            </div>
                            
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h3 class="text-lg font-semibold mb-4">Worst Performing Pair</h3>
                                <div id="worst-pair" class="text-center">
                                    <div class="text-2xl font-bold text-red-400 mb-1">-</div>
                                    <p class="text-sm text-gray-400">No trades yet</p>
                                </div>
                            </div>
                            
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h3 class="text-lg font-semibold mb-4">Average Trade Duration</h3>
                                <div id="avg-duration" class="text-center">
                                    <div class="text-2xl font-bold text-blue-400 mb-1">-</div>
                                    <p class="text-sm text-gray-400">No trades yet</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tools Content -->
                <div id="tools-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8">Trading Tools</h1>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Lot Size Calculator -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h2 class="text-xl font-semibold mb-4">Lot Size Calculator</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Account Balance ($)</label>
                                        <input type="number" id="account-balance" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10000" value="10000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Risk Percentage (%)</label>
                                        <input type="number" id="risk-percentage" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="2" value="2" step="0.1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Entry Price</label>
                                        <input type="number" id="lot-entry-price" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="1.0850" step="0.00001">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Stop Loss</label>
                                        <input type="number" id="lot-stop-loss" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="1.0800" step="0.00001">
                                    </div>
                                    <button onclick="calculateLotSize()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                        Calculate Lot Size
                                    </button>
                                    <div id="lot-size-result" class="bg-dark-700 rounded-lg p-4 hidden">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-indigo-400 mb-2">0.00</div>
                                            <p class="text-sm text-gray-400">Recommended Lot Size</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Risk/Reward Calculator -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h2 class="text-xl font-semibold mb-4">Risk/Reward Calculator</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Entry Price</label>
                                        <input type="number" id="rr-entry-price" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="1.0850" step="0.00001">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Stop Loss</label>
                                        <input type="number" id="rr-stop-loss" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="1.0800" step="0.00001">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Take Profit</label>
                                        <input type="number" id="rr-take-profit" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="1.0950" step="0.00001">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Lot Size</label>
                                        <input type="number" id="rr-lot-size" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0.10" step="0.01">
                                    </div>
                                    <button onclick="calculateRiskReward()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                        Calculate R:R
                                    </button>
                                    <div id="risk-reward-result" class="bg-dark-700 rounded-lg p-4 hidden">
                                        <div class="grid grid-cols-2 gap-4 text-center">
                                            <div>
                                                <div class="text-lg font-bold text-red-400 mb-1">$0.00</div>
                                                <p class="text-xs text-gray-400">Risk</p>
                                            </div>
                                            <div>
                                                <div class="text-lg font-bold text-green-400 mb-1">$0.00</div>
                                                <p class="text-xs text-gray-400">Reward</p>
                                            </div>
                                            <div class="col-span-2">
                                                <div class="text-xl font-bold text-indigo-400 mb-1">1:0</div>
                                                <p class="text-xs text-gray-400">Risk:Reward Ratio</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Scenario Planner -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700 lg:col-span-2">
                                <h2 class="text-xl font-semibold mb-4">Scenario Planner</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">Starting Balance ($)</label>
                                            <input type="number" id="scenario-balance" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10000" value="10000">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">Win Rate (%)</label>
                                            <input type="number" id="scenario-win-rate" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="60" value="60">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">Average Win ($)</label>
                                            <input type="number" id="scenario-avg-win" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="100" value="100">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">Average Loss ($)</label>
                                            <input type="number" id="scenario-avg-loss" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="50" value="50">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">Number of Trades</label>
                                            <input type="number" id="scenario-trades" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="100" value="100">
                                        </div>
                                        <button onclick="calculateScenario()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                            Run Scenario
                                        </button>
                                    </div>
                                    <div id="scenario-results" class="bg-dark-700 rounded-lg p-4">
                                        <h3 class="text-lg font-semibold mb-4">Projected Results</h3>
                                        <div class="space-y-3">
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Expected Wins:</span>
                                                <span id="expected-wins">0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Expected Losses:</span>
                                                <span id="expected-losses">0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Total Profit:</span>
                                                <span id="total-profit" class="text-green-400">$0.00</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Total Loss:</span>
                                                <span id="total-loss" class="text-red-400">$0.00</span>
                                            </div>
                                            <div class="border-t border-dark-600 pt-3">
                                                <div class="flex justify-between font-semibold">
                                                    <span>Net Result:</span>
                                                    <span id="net-result" class="text-indigo-400">$0.00</span>
                                                </div>
                                                <div class="flex justify-between text-sm text-gray-400 mt-1">
                                                    <span>Final Balance:</span>
                                                    <span id="final-balance">$0.00</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Psychology Content -->
                <div id="psychology-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8">Trading Psychology</h1>
                        
                        <!-- Tilt Alert -->
                        <div id="tilt-alert" class="bg-red-900/20 border border-red-500 rounded-xl p-4 mb-8 hidden">
                            <div class="flex items-center space-x-3">
                                <svg class="w-6 h-6 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <h3 class="text-red-400 font-semibold">Tilt Alert!</h3>
                                    <p class="text-red-300 text-sm">You've had 3+ losing trades in a row. Consider taking a break to reset your mindset.</p>
                                </div>
                                <button onclick="dismissTiltAlert()" class="text-red-400 hover:text-red-300">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Daily Mood Tracker -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h2 class="text-xl font-semibold mb-4">Daily Mood & Notes</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-charcoal-300 mb-3">Today's Mood</label>
                                        <div class="flex items-center space-x-4">
                                            <span class="text-2xl">üòû</span>
                                            <input type="range" id="mood-slider" min="1" max="10" value="5" class="flex-1 mood-slider appearance-none cursor-pointer">
                                            <span class="text-2xl">üòä</span>
                                        </div>
                                        <div class="text-center mt-4 p-3 glass rounded-xl">
                                            <span id="mood-value" class="text-2xl font-bold text-navy-400">5</span>
                                            <span class="text-sm text-charcoal-400">/10</span>
                                            <p class="text-xs text-charcoal-400 mt-1">Feeling neutral today</p>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Notes</label>
                                        <textarea id="mood-notes" rows="4" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="How are you feeling about trading today? Any concerns or observations..."></textarea>
                                    </div>
                                    <button onclick="saveMoodEntry()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                        Save Today's Entry
                                    </button>
                                </div>
                            </div>

                            <!-- Habit Tracker -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-semibold">Habit Tracker</h2>
                                    <button onclick="showAddHabitForm()" class="bg-indigo-600 hover:bg-indigo-700 px-3 py-1 rounded text-sm transition-colors">
                                        Add Habit
                                    </button>
                                </div>
                                
                                <!-- Add Habit Form -->
                                <div id="add-habit-form" class="mb-4 hidden">
                                    <div class="flex space-x-2">
                                        <input type="text" id="new-habit-input" placeholder="Enter habit name..." class="flex-1 bg-dark-700 border border-dark-600 rounded px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <button onclick="addHabit()" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded transition-colors">Add</button>
                                        <button onclick="cancelAddHabit()" class="bg-gray-600 hover:bg-gray-700 px-3 py-2 rounded transition-colors">Cancel</button>
                                    </div>
                                </div>

                                <!-- Habits List -->
                                <div id="habits-list" class="space-y-3">
                                    <div class="text-center py-8 text-gray-400">
                                        <p>No habits added yet</p>
                                        <p class="text-sm mt-1">Click "Add Habit" to start tracking</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mood History -->
                        <div class="bg-dark-800 rounded-xl p-6 border border-dark-700 mt-8">
                            <h2 class="text-xl font-semibold mb-4">Mood History</h2>
                            <div id="mood-history" class="space-y-4">
                                <div class="text-center py-8 text-gray-400">
                                    <p>No mood entries yet</p>
                                    <p class="text-sm mt-1">Start tracking your daily mood above</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Playbook Content -->
                <div id="playbook-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-3xl font-bold">Trading Playbook</h1>
                            <button onclick="showAddSetupForm()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                Add Setup
                            </button>
                        </div>

                        <!-- Add Setup Form -->
                        <div id="setup-form" class="bg-dark-800 rounded-xl p-6 border border-dark-700 mb-8 hidden">
                            <h2 class="text-xl font-semibold mb-6">Add New Setup</h2>
                            <form id="setup-form-element" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Setup Title</label>
                                    <input type="text" name="title" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Breakout Strategy">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                    <textarea name="description" rows="4" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Describe your setup, entry/exit rules, conditions..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Setup Image (Optional)</label>
                                    <input type="file" name="image" accept="image/*" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="flex justify-end space-x-4">
                                    <button type="button" onclick="cancelSetupForm()" class="px-6 py-2 border border-dark-600 rounded-lg text-gray-300 hover:bg-dark-700 transition-colors">
                                        Cancel
                                    </button>
                                    <button type="submit" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition-colors">
                                        Save Setup
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Setups Grid -->
                        <div id="setups-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="text-center py-12 text-gray-400 col-span-full">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                                </svg>
                                <p>No setups created yet</p>
                                <p class="text-sm mt-1">Click "Add Setup" to create your first trading setup</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Content -->
                <div id="settings-content" class="page-content hidden">
                    <div class="max-w-4xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8">Settings</h1>
                        
                        <div class="space-y-8">
                            <!-- Account Preferences -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h2 class="text-xl font-semibold mb-4">Account Preferences</h2>
                                <form id="settings-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Account Size ($)</label>
                                        <input type="number" name="accountSize" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10000" value="10000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Base Currency</label>
                                        <select name="baseCurrency" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                            <option value="JPY">JPY</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Default Risk (%)</label>
                                        <input type="number" name="defaultRisk" step="0.1" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="2" value="2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Timezone</label>
                                        <select name="timezone" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option value="UTC">UTC</option>
                                            <option value="America/New_York">New York</option>
                                            <option value="Europe/London">London</option>
                                            <option value="Asia/Tokyo">Tokyo</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-lg text-white font-medium transition-colors">
                                            Save Settings
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Data Management -->
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h2 class="text-xl font-semibold mb-4">Data Management</h2>
                                
                                <!-- Export Section -->
                                <div class="mb-6">
                                    <h3 class="text-lg font-medium mb-3">Export Data</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <button onclick="exportData('csv')" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                                            Export CSV
                                        </button>
                                        <button onclick="exportData('json')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                            Export JSON
                                        </button>
                                        <button onclick="exportData('xlsx')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                                            Export Excel
                                        </button>
                                    </div>
                                </div>

                                <!-- Import Section -->
                                <div class="mb-6">
                                    <h3 class="text-lg font-medium mb-3">Import Data</h3>
                                    <div class="space-y-4">
                                        <input type="file" id="import-file" accept=".csv,.json,.xlsx,.emb" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <button onclick="importData()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg transition-colors">
                                            Import File
                                        </button>
                                    </div>
                                </div>

                                <!-- Backup Section -->
                                <div>
                                    <h3 class="text-lg font-medium mb-3">Backup & Restore</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <button onclick="createBackup()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg transition-colors">
                                            Create Encrypted Backup
                                        </button>
                                        <button onclick="restoreBackup()" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg transition-colors">
                                            Restore from Backup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payments Content -->
                <div id="payments-content" class="page-content hidden">
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8">Subscription & Billing</h1>
                        
                        <!-- Current Plan -->
                        <div class="bg-dark-800 rounded-xl p-6 border border-dark-700 mb-8">
                            <h2 class="text-xl font-semibold mb-4">Current Plan</h2>
                            <div id="current-plan-info" class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-medium text-indigo-400">Free Plan</h3>
                                    <p class="text-gray-400">Basic trading journal features</p>
                                </div>
                                <button id="upgrade-btn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                    Upgrade Plan
                                </button>
                            </div>
                        </div>

                        <!-- Subscription Plans -->
                        <div id="subscription-plans" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 hidden">
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h3 class="text-lg font-semibold mb-2">Free</h3>
                                <div class="text-3xl font-bold mb-4">$0<span class="text-sm text-gray-400">/month</span></div>
                                <ul class="space-y-2 mb-6 text-sm text-gray-300">
                                    <li>‚úì Basic journal</li>
                                    <li>‚úì Dashboard</li>
                                    <li>‚úì Settings</li>
                                    <li class="text-gray-500">‚úó Analytics</li>
                                    <li class="text-gray-500">‚úó Tools</li>
                                </ul>
                                <button class="w-full bg-gray-600 text-gray-400 py-2 rounded-lg cursor-not-allowed">Current Plan</button>
                            </div>
                            
                            <div class="bg-dark-800 rounded-xl p-6 border border-indigo-500 relative">
                                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-indigo-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                                    Popular
                                </div>
                                <h3 class="text-lg font-semibold mb-2">Pro</h3>
                                <div class="text-3xl font-bold mb-4">$19.99<span class="text-sm text-gray-400">/month</span></div>
                                <ul class="space-y-2 mb-6 text-sm text-gray-300">
                                    <li>‚úì Everything in Free</li>
                                    <li>‚úì Advanced analytics</li>
                                    <li>‚úì Trading tools</li>
                                    <li>‚úì Risk calculators</li>
                                    <li class="text-gray-500">‚úó Psychology module</li>
                                </ul>
                                <button onclick="subscribeToPlan('pro')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                    Upgrade to Pro
                                </button>
                            </div>
                            
                            <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                                <h3 class="text-lg font-semibold mb-2">Team</h3>
                                <div class="text-3xl font-bold mb-4">$49.99<span class="text-sm text-gray-400">/month</span></div>
                                <ul class="space-y-2 mb-6 text-sm text-gray-300">
                                    <li>‚úì Everything in Pro</li>
                                    <li>‚úì Psychology module</li>
                                    <li>‚úì Trading playbook</li>
                                    <li>‚úì Team collaboration</li>
                                    <li>‚úì Priority support</li>
                                </ul>
                                <button onclick="subscribeToPlan('team')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                                    Upgrade to Team
                                </button>
                            </div>
                        </div>

                        <!-- Billing History -->
                        <div class="bg-dark-800 rounded-xl border border-dark-700 overflow-hidden mb-8">
                            <div class="px-6 py-4 border-b border-dark-700">
                                <h2 class="text-xl font-semibold">Billing History</h2>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-dark-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Plan</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="billing-history-body" class="divide-y divide-dark-700">
                                        <tr>
                                            <td colspan="4" class="px-6 py-12 text-center text-gray-400">
                                                No billing history available
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Cancel Subscription -->
                        <div id="cancel-subscription" class="bg-dark-800 rounded-xl p-6 border border-red-500/20 hidden">
                            <h2 class="text-xl font-semibold mb-4 text-red-400">Cancel Subscription</h2>
                            <p class="text-gray-400 mb-4">
                                Your subscription will remain active until the end of your current billing period.
                            </p>
                            <button id="cancel-subscription-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Cancel Subscription
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 lg:hidden hidden"></div>
    </div>

    <!-- Modal System -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden animate-fade-in">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div id="modal-content" class="glass rounded-2xl p-6 max-w-md w-full animate-scale-in shadow-2xl">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICd0cmFkaW5nLWpvdXJuYWwtdjEnOwpjb25zdCB1cmxzVG9DYWNoZSA9IFsKICAnLycsCiAgJy9pbmRleC5odG1sJwpdOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbCgKICAgIGNhY2hlcy5vcGVuKENBQ0hFX05BTUUpCiAgICAgIC50aGVuKGNhY2hlID0+IGNhY2hlLmFkZEFsbCh1cmxzVG9DYWNoZSkpCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpCiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICAgIH0pCiAgKTsKfSk7')
                .then(() => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }

        // IndexedDB Setup
        class TradeDB {
            constructor() {
                this.dbName = 'EdgeMetricsDB';
                this.version = 2;
                this.db = null;
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Create trades store
                        if (!db.objectStoreNames.contains('trades')) {
                            const tradesStore = db.createObjectStore('trades', { keyPath: 'id', autoIncrement: true });
                            tradesStore.createIndex('date', 'date', { unique: false });
                            tradesStore.createIndex('instrument', 'instrument', { unique: false });
                        }

                        // Create mood entries store
                        if (!db.objectStoreNames.contains('moodEntries')) {
                            const moodStore = db.createObjectStore('moodEntries', { keyPath: 'id', autoIncrement: true });
                            moodStore.createIndex('date', 'date', { unique: false });
                        }

                        // Create habits store
                        if (!db.objectStoreNames.contains('habits')) {
                            const habitsStore = db.createObjectStore('habits', { keyPath: 'id', autoIncrement: true });
                        }

                        // Create habit entries store
                        if (!db.objectStoreNames.contains('habitEntries')) {
                            const habitEntriesStore = db.createObjectStore('habitEntries', { keyPath: 'id', autoIncrement: true });
                            habitEntriesStore.createIndex('date', 'date', { unique: false });
                            habitEntriesStore.createIndex('habitId', 'habitId', { unique: false });
                        }

                        // Create setups store
                        if (!db.objectStoreNames.contains('setups')) {
                            const setupsStore = db.createObjectStore('setups', { keyPath: 'id', autoIncrement: true });
                        }

                        // Create settings store
                        if (!db.objectStoreNames.contains('settings')) {
                            const settingsStore = db.createObjectStore('settings', { keyPath: 'key' });
                        }
                    };
                });
            }

            async addTrade(trade) {
                const transaction = this.db.transaction(['trades'], 'readwrite');
                const store = transaction.objectStore('trades');
                return store.add({ ...trade, date: new Date().toISOString() });
            }

            async getAllTrades() {
                const transaction = this.db.transaction(['trades'], 'readonly');
                const store = transaction.objectStore('trades');
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Mood entries methods
            async addMoodEntry(entry) {
                const transaction = this.db.transaction(['moodEntries'], 'readwrite');
                const store = transaction.objectStore('moodEntries');
                return store.add({ ...entry, date: new Date().toISOString().split('T')[0] });
            }

            async getAllMoodEntries() {
                const transaction = this.db.transaction(['moodEntries'], 'readonly');
                const store = transaction.objectStore('moodEntries');
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            // Habits methods
            async addHabit(habit) {
                const transaction = this.db.transaction(['habits'], 'readwrite');
                const store = transaction.objectStore('habits');
                return store.add(habit);
            }

            async getAllHabits() {
                const transaction = this.db.transaction(['habits'], 'readonly');
                const store = transaction.objectStore('habits');
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async deleteHabit(id) {
                const transaction = this.db.transaction(['habits'], 'readwrite');
                const store = transaction.objectStore('habits');
                return store.delete(id);
            }

            // Habit entries methods
            async addHabitEntry(entry) {
                const transaction = this.db.transaction(['habitEntries'], 'readwrite');
                const store = transaction.objectStore('habitEntries');
                return store.add({ ...entry, date: new Date().toISOString().split('T')[0] });
            }

            async getHabitEntriesForDate(date) {
                const transaction = this.db.transaction(['habitEntries'], 'readonly');
                const store = transaction.objectStore('habitEntries');
                const index = store.index('date');
                return new Promise((resolve, reject) => {
                    const request = index.getAll(date);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async deleteHabitEntry(habitId, date) {
                const transaction = this.db.transaction(['habitEntries'], 'readwrite');
                const store = transaction.objectStore('habitEntries');
                const entries = await this.getHabitEntriesForDate(date);
                const entry = entries.find(e => e.habitId === habitId);
                if (entry) {
                    return store.delete(entry.id);
                }
            }

            // Setups methods
            async addSetup(setup) {
                const transaction = this.db.transaction(['setups'], 'readwrite');
                const store = transaction.objectStore('setups');
                return store.add({ ...setup, createdAt: new Date().toISOString() });
            }

            async getAllSetups() {
                const transaction = this.db.transaction(['setups'], 'readonly');
                const store = transaction.objectStore('setups');
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async deleteSetup(id) {
                const transaction = this.db.transaction(['setups'], 'readwrite');
                const store = transaction.objectStore('setups');
                return store.delete(id);
            }

            // Settings methods
            async saveSetting(key, value) {
                const transaction = this.db.transaction(['settings'], 'readwrite');
                const store = transaction.objectStore('settings');
                return store.put({ key, value });
            }

            async getSetting(key) {
                const transaction = this.db.transaction(['settings'], 'readonly');
                const store = transaction.objectStore('settings');
                return new Promise((resolve, reject) => {
                    const request = store.get(key);
                    request.onsuccess = () => resolve(request.result?.value);
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // Subscription Management
        class SubscriptionManager {
            constructor() {
                this.plans = {
                    free: { name: 'Free', price: 0, features: ['dashboard', 'journal', 'settings'] },
                    pro: { name: 'Pro', price: 19.99, features: ['dashboard', 'journal', 'analytics', 'tools', 'settings'] },
                    team: { name: 'Team', price: 49.99, features: ['dashboard', 'journal', 'analytics', 'tools', 'psychology', 'playbook', 'settings'] }
                };
                this.currentPlan = 'free';
                this.init();
            }

            init() {
                const savedPlan = localStorage.getItem('edgeMetrics_subscription');
                if (savedPlan) {
                    this.currentPlan = savedPlan;
                }
            }

            hasFeatureAccess(feature) {
                return this.plans[this.currentPlan].features.includes(feature);
            }

            upgradePlan(planId) {
                this.currentPlan = planId;
                localStorage.setItem('edgeMetrics_subscription', planId);
                this.updateFeatureAccess();
            }

            updateFeatureAccess() {
                // Update navigation visibility based on plan
                const restrictedRoutes = {
                    'analytics': ['pro', 'team'],
                    'tools': ['pro', 'team'],
                    'psychology': ['team'],
                    'playbook': ['team']
                };

                Object.entries(restrictedRoutes).forEach(([route, allowedPlans]) => {
                    const navLink = document.querySelector(`[data-route="${route}"]`);
                    if (navLink) {
                        if (allowedPlans.includes(this.currentPlan)) {
                            navLink.style.display = 'flex';
                        } else {
                            navLink.style.display = 'none';
                        }
                    }
                });
            }

            async processPayment(planId) {
                // Simulate Stripe payment processing
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const paymentId = 'pi_' + Math.random().toString(36).substr(2, 9);
                        const subscription = {
                            id: 'sub_' + Math.random().toString(36).substr(2, 9),
                            planId: planId,
                            status: 'active',
                            currentPeriodStart: new Date().toISOString(),
                            currentPeriodEnd: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                            paymentId: paymentId
                        };
                        
                        // Save subscription
                        localStorage.setItem('edgeMetrics_subscription_data', JSON.stringify(subscription));
                        
                        // Add to billing history
                        const history = JSON.parse(localStorage.getItem('edgeMetrics_billing_history') || '[]');
                        history.push({
                            id: paymentId,
                            date: new Date().toISOString(),
                            amount: this.plans[planId].price,
                            plan: this.plans[planId].name,
                            status: 'paid'
                        });
                        localStorage.setItem('edgeMetrics_billing_history', JSON.stringify(history));
                        
                        resolve(subscription);
                    }, 2000);
                });
            }
        }

        // Authentication System
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.isAuthenticated = false;
                this.init();
            }

            init() {
                // Check for existing session
                const savedUser = localStorage.getItem('edgeMetrics_user');
                const savedToken = localStorage.getItem('edgeMetrics_token');
                
                if (savedUser && savedToken) {
                    try {
                        this.currentUser = JSON.parse(savedUser);
                        this.isAuthenticated = true;
                        this.showMainApp();
                    } catch (error) {
                        this.logout();
                    }
                } else {
                    this.showAuthScreen();
                }
            }

            async login(email, password) {
                // Simulate JWT authentication
                if (!email || !password) {
                    throw new Error('Email and password are required');
                }

                // Simple validation (in real app, this would be server-side)
                const users = JSON.parse(localStorage.getItem('edgeMetrics_users') || '[]');
                const user = users.find(u => u.email === email);
                
                if (!user || user.password !== this.hashPassword(password)) {
                    throw new Error('Invalid email or password');
                }

                // Generate mock JWT token
                const token = this.generateToken(user);
                
                this.currentUser = { id: user.id, email: user.email, name: user.name };
                this.isAuthenticated = true;
                
                localStorage.setItem('edgeMetrics_user', JSON.stringify(this.currentUser));
                localStorage.setItem('edgeMetrics_token', token);
                
                this.showMainApp();
                return this.currentUser;
            }

            async signup(name, email, password) {
                if (!name || !email || !password) {
                    throw new Error('All fields are required');
                }

                if (password.length < 6) {
                    throw new Error('Password must be at least 6 characters');
                }

                const users = JSON.parse(localStorage.getItem('edgeMetrics_users') || '[]');
                
                if (users.find(u => u.email === email)) {
                    throw new Error('Email already exists');
                }

                const newUser = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password: this.hashPassword(password),
                    createdAt: new Date().toISOString()
                };

                users.push(newUser);
                localStorage.setItem('edgeMetrics_users', JSON.stringify(users));

                return this.login(email, password);
            }

            async loginWithGoogle() {
                // Simulate Google OAuth (in real app, use Google OAuth SDK)
                return new Promise((resolve, reject) => {
                    // Mock Google login dialog
                    const email = prompt('Enter your Google email (demo):');
                    if (!email) {
                        reject(new Error('Google login cancelled'));
                        return;
                    }

                    const mockGoogleUser = {
                        id: 'google_' + Date.now(),
                        email: email,
                        name: email.split('@')[0],
                        provider: 'google'
                    };

                    const token = this.generateToken(mockGoogleUser);
                    
                    this.currentUser = mockGoogleUser;
                    this.isAuthenticated = true;
                    
                    localStorage.setItem('edgeMetrics_user', JSON.stringify(this.currentUser));
                    localStorage.setItem('edgeMetrics_token', token);
                    
                    this.showMainApp();
                    resolve(this.currentUser);
                });
            }

            logout() {
                this.currentUser = null;
                this.isAuthenticated = false;
                localStorage.removeItem('edgeMetrics_user');
                localStorage.removeItem('edgeMetrics_token');
                this.showAuthScreen();
            }

            hashPassword(password) {
                // Simple hash for demo (use proper hashing in production)
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }

            generateToken(user) {
                // Mock JWT token generation
                const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
                const payload = btoa(JSON.stringify({ 
                    sub: user.id, 
                    email: user.email, 
                    exp: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                }));
                const signature = btoa('mock_signature');
                return `${header}.${payload}.${signature}`;
            }

            showAuthScreen() {
                document.getElementById('app').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
            }

            showMainApp() {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                
                // Update user info in header
                const userInitials = this.currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.querySelector('.w-8.h-8.bg-indigo-600 span').textContent = userInitials;
                
                // Initialize database and load trades for authenticated user
                tradeDB.init().then(() => {
                    console.log('Database initialized for user:', this.currentUser.email);
                    loadTrades();
                });

                // Initialize subscription features
                subscriptionManager.updateFeatureAccess();
                updatePaymentsPage();
            }

            requireAuth() {
                if (!this.isAuthenticated) {
                    this.showAuthScreen();
                    return false;
                }
                return true;
            }
        }

        // Initialize Authentication and Subscription
        const authManager = new AuthManager();
        const subscriptionManager = new SubscriptionManager();

        // Subscription Functions
        async function subscribeToPlan(planId) {
            if (!authManager.isAuthenticated) {
                alert('Please log in to subscribe');
                return;
            }

            const plan = subscriptionManager.plans[planId];
            if (!plan) return;

            if (confirm(`Subscribe to ${plan.name} plan for $${plan.price}/month?`)) {
                try {
                    const subscription = await subscriptionManager.processPayment(planId);
                    subscriptionManager.upgradePlan(planId);
                    updatePaymentsPage();
                    alert(`Successfully subscribed to ${plan.name} plan!`);
                } catch (error) {
                    alert('Payment failed. Please try again.');
                }
            }
        }

        function updatePaymentsPage() {
            const currentPlan = subscriptionManager.plans[subscriptionManager.currentPlan];
            const planInfo = document.getElementById('current-plan-info');
            
            planInfo.innerHTML = `
                <div>
                    <h3 class="text-lg font-medium text-indigo-400">${currentPlan.name} Plan</h3>
                    <p class="text-gray-400">$${currentPlan.price}/month</p>
                </div>
                <button id="upgrade-btn" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-medium transition-colors">
                    ${subscriptionManager.currentPlan === 'free' ? 'Upgrade Plan' : 'Change Plan'}
                </button>
            `;

            // Update billing history
            const billingHistory = JSON.parse(localStorage.getItem('edgeMetrics_billing_history') || '[]');
            const tbody = document.getElementById('billing-history-body');
            
            if (billingHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-12 text-center text-gray-400">No billing history available</td></tr>';
            } else {
                tbody.innerHTML = billingHistory.map(payment => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${new Date(payment.date).toLocaleDateString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${payment.plan}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">$${payment.amount}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">${payment.status}</td>
                    </tr>
                `).join('');
            }

            // Show/hide cancel subscription
            const cancelSection = document.getElementById('cancel-subscription');
            if (subscriptionManager.currentPlan !== 'free') {
                cancelSection.classList.remove('hidden');
            } else {
                cancelSection.classList.add('hidden');
            }

            // Re-attach upgrade button event with proper error handling
            setTimeout(() => {
                const upgradeBtn = document.getElementById('upgrade-btn');
                if (upgradeBtn) {
                    upgradeBtn.addEventListener('click', () => {
                        const plansSection = document.getElementById('subscription-plans');
                        if (plansSection) {
                            plansSection.classList.toggle('hidden');
                            showToast('Select a plan below to upgrade', 'info');
                        }
                    });
                }
            }, 100);
        }

        // Trading Tools Functions
        function calculateLotSize() {
            const balance = parseFloat(document.getElementById('account-balance').value) || 0;
            const riskPercent = parseFloat(document.getElementById('risk-percentage').value) || 0;
            const entryPrice = parseFloat(document.getElementById('lot-entry-price').value) || 0;
            const stopLoss = parseFloat(document.getElementById('lot-stop-loss').value) || 0;

            if (!balance || !riskPercent || !entryPrice || !stopLoss) {
                alert('Please fill in all fields');
                return;
            }

            const riskAmount = balance * (riskPercent / 100);
            const pipValue = 10; // Simplified pip value for major pairs
            const pips = Math.abs(entryPrice - stopLoss) * 10000;
            const lotSize = riskAmount / (pips * pipValue);

            const resultDiv = document.getElementById('lot-size-result');
            resultDiv.querySelector('.text-2xl').textContent = lotSize.toFixed(2);
            resultDiv.classList.remove('hidden');
        }

        function calculateRiskReward() {
            const entryPrice = parseFloat(document.getElementById('rr-entry-price').value) || 0;
            const stopLoss = parseFloat(document.getElementById('rr-stop-loss').value) || 0;
            const takeProfit = parseFloat(document.getElementById('rr-take-profit').value) || 0;
            const lotSize = parseFloat(document.getElementById('rr-lot-size').value) || 0;

            if (!entryPrice || !stopLoss || !takeProfit || !lotSize) {
                alert('Please fill in all fields');
                return;
            }

            const pipValue = 10;
            const riskPips = Math.abs(entryPrice - stopLoss) * 10000;
            const rewardPips = Math.abs(takeProfit - entryPrice) * 10000;
            
            const riskAmount = riskPips * pipValue * lotSize;
            const rewardAmount = rewardPips * pipValue * lotSize;
            const ratio = riskAmount > 0 ? (rewardAmount / riskAmount).toFixed(1) : 0;

            const resultDiv = document.getElementById('risk-reward-result');
            const values = resultDiv.querySelectorAll('.text-lg, .text-xl');
            values[0].textContent = `$${riskAmount.toFixed(2)}`;
            values[1].textContent = `$${rewardAmount.toFixed(2)}`;
            values[2].textContent = `1:${ratio}`;
            
            resultDiv.classList.remove('hidden');
        }

        function calculateScenario() {
            const balance = parseFloat(document.getElementById('scenario-balance').value) || 0;
            const winRate = parseFloat(document.getElementById('scenario-win-rate').value) || 0;
            const avgWin = parseFloat(document.getElementById('scenario-avg-win').value) || 0;
            const avgLoss = parseFloat(document.getElementById('scenario-avg-loss').value) || 0;
            const totalTrades = parseFloat(document.getElementById('scenario-trades').value) || 0;

            if (!balance || !winRate || !avgWin || !avgLoss || !totalTrades) {
                alert('Please fill in all fields');
                return;
            }

            const expectedWins = Math.round(totalTrades * (winRate / 100));
            const expectedLosses = totalTrades - expectedWins;
            const totalProfit = expectedWins * avgWin;
            const totalLoss = expectedLosses * avgLoss;
            const netResult = totalProfit - totalLoss;
            const finalBalance = balance + netResult;

            document.getElementById('expected-wins').textContent = expectedWins;
            document.getElementById('expected-losses').textContent = expectedLosses;
            document.getElementById('total-profit').textContent = `$${totalProfit.toFixed(2)}`;
            document.getElementById('total-loss').textContent = `$${totalLoss.toFixed(2)}`;
            document.getElementById('net-result').textContent = `$${netResult.toFixed(2)}`;
            document.getElementById('final-balance').textContent = `$${finalBalance.toFixed(2)}`;

            // Update colors based on result
            const netResultEl = document.getElementById('net-result');
            netResultEl.className = netResult >= 0 ? 'text-green-400' : 'text-red-400';
        }

        // Trade Management
        let trades = [];
        let editingTradeId = null;

        async function loadTrades() {
            try {
                trades = await tradeDB.getAllTrades();
                renderTradesTable();
                updateDashboardKPIs();
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }

        function calculatePnL(trade) {
            if (!trade.exit || !trade.entry || !trade.lotSize) return 0;
            const pipValue = 10; // Simplified pip value
            const pips = (trade.exit - trade.entry) * Math.pow(10, 4);
            return pips * trade.lotSize * pipValue;
        }

        function renderTradesTable() {
            const tbody = document.getElementById('trades-table-body');
            const noTradesRow = document.getElementById('no-trades-row');
            
            if (trades.length === 0) {
                noTradesRow.style.display = 'table-row';
                return;
            }
            
            noTradesRow.style.display = 'none';
            
            const tradesHtml = trades.map((trade, index) => {
                const pnl = calculatePnL(trade);
                const pnlClass = pnl >= 0 ? 'text-green-400' : 'text-red-400';
                const pnlIcon = pnl >= 0 ? 'trending-up' : 'trending-down';
                const date = new Date(trade.date).toLocaleDateString();
                const accountIcons = {
                    'demo': 'üìä',
                    'live': 'üí∞',
                    'prop': 'üè¢'
                };
                
                return `
                    <tr class="table-row smart-hover animate-slide-up gpu-accelerated" style="animation-delay: ${index * 0.1}s">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-charcoal-300">
                            <div class="flex items-center space-x-2">
                                <i data-lucide="calendar" class="w-4 h-4 text-charcoal-500"></i>
                                <span>${date}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-white">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"></div>
                                <span>${trade.instrument}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-charcoal-300 font-mono">${trade.entry}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-charcoal-300 font-mono">${trade.exit || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-charcoal-300">${trade.lotSize}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold ${pnlClass}">
                            <div class="flex items-center space-x-2">
                                <i data-lucide="${pnlIcon}" class="w-4 h-4"></i>
                                <span>$${pnl.toFixed(2)}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-charcoal-300">
                            <div class="flex items-center space-x-2">
                                <span>${accountIcons[trade.account] || 'üìä'}</span>
                                <span class="capitalize">${trade.account}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <div class="flex items-center space-x-2">
                                <button onclick="editTrade(${trade.id})" class="p-2 rounded-lg hover:bg-indigo-500/20 text-indigo-400 hover:text-indigo-300 transition-all duration-200 tooltip" data-tooltip="Edit trade">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteTrade(${trade.id})" class="p-2 rounded-lg hover:bg-red-500/20 text-red-400 hover:text-red-300 transition-all duration-200 tooltip" data-tooltip="Delete trade">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = tradesHtml;
            
            // Re-initialize Lucide icons for the new content
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }

        function updateDashboardKPIs() {
            const totalTrades = trades.length;
            const winningTrades = trades.filter(trade => calculatePnL(trade) > 0).length;
            const winRate = totalTrades > 0 ? (winningTrades / totalTrades * 100).toFixed(1) : 0;
            const totalPnL = trades.reduce((sum, trade) => sum + calculatePnL(trade), 0);
            const bestTrade = trades.length > 0 ? Math.max(...trades.map(calculatePnL)) : 0;

            // Animate counters with smart counting
            animateCounter('total-trades-counter', totalTrades, 0, '');
            animateCounter('win-rate-counter', parseFloat(winRate), 0, '%');
            animateCounter('pnl-counter', totalPnL, 0, '$', 2);
            animateCounter('best-trade-counter', bestTrade, 0, '$', 2);

            // Update progress bars
            const winRateProgress = document.getElementById('win-rate-progress');
            if (winRateProgress) {
                setTimeout(() => {
                    winRateProgress.style.width = `${Math.min(winRate, 100)}%`;
                }, 500);
            }

            // Update status indicators
            const pnlStatus = document.getElementById('pnl-status');
            if (pnlStatus) {
                const returnPercent = totalTrades > 0 ? ((totalPnL / (totalTrades * 100)) * 100).toFixed(1) : 0;
                pnlStatus.textContent = `${returnPercent}% return`;
                pnlStatus.className = `text-xs text-charcoal-400 status-indicator ${totalPnL >= 0 ? 'status-online' : 'status-error'}`;
            }

            // Update analytics
            updateAnalytics();
        }

        // Smart counter animation function
        function animateCounter(elementId, targetValue, startValue = 0, prefix = '', decimals = 0) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const duration = 1500; // 1.5 seconds
            const startTime = performance.now();
            const difference = targetValue - startValue;

            function updateCounter(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = startValue + (difference * easeOutQuart);
                
                const displayValue = decimals > 0 ? currentValue.toFixed(decimals) : Math.floor(currentValue);
                element.textContent = `${prefix}${displayValue}${prefix === '$' ? '' : prefix}`;
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    // Ensure final value is exact
                    const finalValue = decimals > 0 ? targetValue.toFixed(decimals) : targetValue;
                    element.textContent = `${prefix}${finalValue}${prefix === '$' ? '' : prefix}`;
                }
            }

            requestAnimationFrame(updateCounter);
        }

        function updateAnalytics() {
            updateProfitByInstrument();
            updateWinLossChart();
            updateRiskRewardRatio();
            updatePerformanceMetrics();
        }

        function updateProfitByInstrument() {
            const container = document.getElementById('profit-by-instrument');
            
            if (trades.length === 0) {
                container.innerHTML = `
                    <div class="text-center">
                        <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        <p>No data available</p>
                    </div>
                `;
                return;
            }

            const instrumentPnL = {};
            trades.forEach(trade => {
                const pnl = calculatePnL(trade);
                instrumentPnL[trade.instrument] = (instrumentPnL[trade.instrument] || 0) + pnl;
            });

            const maxPnL = Math.max(...Object.values(instrumentPnL));
            const minPnL = Math.min(...Object.values(instrumentPnL));
            const range = Math.max(Math.abs(maxPnL), Math.abs(minPnL));

            const barsHtml = Object.entries(instrumentPnL)
                .sort(([,a], [,b]) => b - a)
                .map(([instrument, pnl]) => {
                    const percentage = range > 0 ? Math.abs(pnl) / range * 100 : 0;
                    const color = pnl >= 0 ? 'bg-green-500' : 'bg-red-500';
                    
                    return `
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium w-16">${instrument}</span>
                            <div class="flex-1 mx-3 bg-dark-700 rounded-full h-4 relative">
                                <div class="${color} h-4 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm w-20 text-right ${pnl >= 0 ? 'text-green-400' : 'text-red-400'}">$${pnl.toFixed(2)}</span>
                        </div>
                    `;
                }).join('');

            container.innerHTML = `<div class="space-y-2">${barsHtml}</div>`;
        }

        function updateWinLossChart() {
            const container = document.getElementById('win-loss-chart');
            
            if (trades.length === 0) {
                container.innerHTML = `
                    <div class="text-center">
                        <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        <p>No data available</p>
                    </div>
                `;
                return;
            }

            const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
            let runningPnL = 0;
            const maxTrades = Math.min(sortedTrades.length, 20);
            
            const chartData = sortedTrades.slice(-maxTrades).map((trade, index) => {
                runningPnL += calculatePnL(trade);
                return { index: index + 1, pnl: runningPnL, tradePnL: calculatePnL(trade) };
            });

            const maxPnL = Math.max(...chartData.map(d => d.pnl));
            const minPnL = Math.min(...chartData.map(d => d.pnl));
            const range = maxPnL - minPnL || 1;

            const pointsHtml = chartData.map((point, index) => {
                const x = (index / (chartData.length - 1)) * 90 + 5;
                const y = 90 - ((point.pnl - minPnL) / range) * 80;
                const color = point.tradePnL >= 0 ? '#10b981' : '#ef4444';
                
                return `<circle cx="${x}%" cy="${y}%" r="3" fill="${color}" opacity="0.8"/>`;
            }).join('');

            const linePoints = chartData.map((point, index) => {
                const x = (index / (chartData.length - 1)) * 90 + 5;
                const y = 90 - ((point.pnl - minPnL) / range) * 80;
                return `${x},${y}`;
            }).join(' ');

            container.innerHTML = `
                <svg class="w-full h-full" viewBox="0 0 100 100">
                    <polyline points="${linePoints}" fill="none" stroke="#6366f1" stroke-width="0.5" opacity="0.7"/>
                    ${pointsHtml}
                </svg>
            `;
        }

        function updateRiskRewardRatio() {
            const rrrDisplay = document.getElementById('rrr-display');
            
            if (trades.length === 0) {
                rrrDisplay.innerHTML = `
                    <div class="text-4xl font-bold text-indigo-400 mb-2">0:0</div>
                    <p class="text-gray-400">Average Risk-Reward Ratio</p>
                `;
                return;
            }

            const validTrades = trades.filter(trade => trade.stopLoss && trade.takeProfit && trade.entry);
            
            if (validTrades.length === 0) {
                rrrDisplay.innerHTML = `
                    <div class="text-4xl font-bold text-gray-400 mb-2">N/A</div>
                    <p class="text-gray-400">No trades with SL/TP data</p>
                `;
                return;
            }

            const avgRisk = validTrades.reduce((sum, trade) => {
                return sum + Math.abs(trade.entry - trade.stopLoss);
            }, 0) / validTrades.length;

            const avgReward = validTrades.reduce((sum, trade) => {
                return sum + Math.abs(trade.takeProfit - trade.entry);
            }, 0) / validTrades.length;

            const ratio = avgRisk > 0 ? (avgReward / avgRisk).toFixed(1) : 0;

            rrrDisplay.innerHTML = `
                <div class="text-4xl font-bold text-indigo-400 mb-2">1:${ratio}</div>
                <p class="text-gray-400">Average Risk-Reward Ratio</p>
            `;
        }

        function updatePerformanceMetrics() {
            const bestPairEl = document.getElementById('best-pair');
            const worstPairEl = document.getElementById('worst-pair');
            const avgDurationEl = document.getElementById('avg-duration');

            if (trades.length === 0) {
                bestPairEl.innerHTML = `<div class="text-2xl font-bold text-green-400 mb-1">-</div><p class="text-sm text-gray-400">No trades yet</p>`;
                worstPairEl.innerHTML = `<div class="text-2xl font-bold text-red-400 mb-1">-</div><p class="text-sm text-gray-400">No trades yet</p>`;
                avgDurationEl.innerHTML = `<div class="text-2xl font-bold text-blue-400 mb-1">-</div><p class="text-sm text-gray-400">No trades yet</p>`;
                return;
            }

            // Best/Worst performing pairs
            const instrumentPnL = {};
            trades.forEach(trade => {
                const pnl = calculatePnL(trade);
                instrumentPnL[trade.instrument] = (instrumentPnL[trade.instrument] || 0) + pnl;
            });

            const sortedInstruments = Object.entries(instrumentPnL).sort(([,a], [,b]) => b - a);
            const bestPair = sortedInstruments[0];
            const worstPair = sortedInstruments[sortedInstruments.length - 1];

            bestPairEl.innerHTML = `
                <div class="text-2xl font-bold text-green-400 mb-1">${bestPair[0]}</div>
                <p class="text-sm text-gray-400">$${bestPair[1].toFixed(2)}</p>
            `;

            worstPairEl.innerHTML = `
                <div class="text-2xl font-bold text-red-400 mb-1">${worstPair[0]}</div>
                <p class="text-sm text-gray-400">$${worstPair[1].toFixed(2)}</p>
            `;

            // Average duration (simplified - showing trade count for now)
            avgDurationEl.innerHTML = `
                <div class="text-2xl font-bold text-blue-400 mb-1">${trades.length}</div>
                <p class="text-sm text-gray-400">Total trades</p>
            `;
        }

        // Form handling
        document.getElementById('add-trade-btn').addEventListener('click', () => {
            document.getElementById('trade-form').classList.remove('hidden');
            editingTradeId = null;
        });

        document.getElementById('cancel-trade-btn').addEventListener('click', () => {
            document.getElementById('trade-form').classList.add('hidden');
            document.getElementById('trade-form-element').reset();
            editingTradeId = null;
        });

        document.getElementById('trade-form-element').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const trade = {
                instrument: formData.get('instrument'),
                entry: parseFloat(formData.get('entry')),
                exit: formData.get('exit') ? parseFloat(formData.get('exit')) : null,
                stopLoss: formData.get('stopLoss') ? parseFloat(formData.get('stopLoss')) : null,
                takeProfit: formData.get('takeProfit') ? parseFloat(formData.get('takeProfit')) : null,
                lotSize: parseFloat(formData.get('lotSize')),
                account: formData.get('account'),
                tags: formData.get('tags'),
                notes: formData.get('notes')
            };

            try {
                if (editingTradeId) {
                    // Update existing trade
                    const transaction = tradeDB.db.transaction(['trades'], 'readwrite');
                    const store = transaction.objectStore('trades');
                    await store.put({ ...trade, id: editingTradeId, date: trades.find(t => t.id === editingTradeId).date });
                } else {
                    // Add new trade
                    await tradeDB.addTrade(trade);
                }
                
                document.getElementById('trade-form').classList.add('hidden');
                e.target.reset();
                editingTradeId = null;
                await loadTrades();
            } catch (error) {
                console.error('Error saving trade:', error);
                alert('Error saving trade. Please try again.');
            }
        });

        async function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            editingTradeId = id;
            const form = document.getElementById('trade-form-element');
            
            form.instrument.value = trade.instrument;
            form.entry.value = trade.entry;
            form.exit.value = trade.exit || '';
            form.stopLoss.value = trade.stopLoss || '';
            form.takeProfit.value = trade.takeProfit || '';
            form.lotSize.value = trade.lotSize;
            form.account.value = trade.account;
            form.tags.value = trade.tags || '';
            form.notes.value = trade.notes || '';

            document.getElementById('trade-form').classList.remove('hidden');
        }

        async function deleteTrade(id) {
            if (!confirm('Are you sure you want to delete this trade?')) return;

            try {
                const transaction = tradeDB.db.transaction(['trades'], 'readwrite');
                const store = transaction.objectStore('trades');
                await store.delete(id);
                await loadTrades();
            } catch (error) {
                console.error('Error deleting trade:', error);
                alert('Error deleting trade. Please try again.');
            }
        }

        // Navigation System
        class Router {
            constructor() {
                this.routes = {
                    'dashboard': 'dashboard-content',
                    'journal': 'journal-content',
                    'analytics': 'analytics-content',
                    'tools': 'tools-content',
                    'psychology': 'psychology-content',
                    'playbook': 'playbook-content',
                    'settings': 'settings-content',
                    'payments': 'payments-content'
                };
                this.currentRoute = 'dashboard';
                this.init();
            }

            init() {
                // Handle navigation clicks
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const route = link.dataset.route;
                        this.navigate(route);
                    });
                });

                // Handle browser back/forward
                window.addEventListener('popstate', (e) => {
                    const route = e.state?.route || 'dashboard';
                    this.navigate(route, false);
                });

                // Set initial route
                const hash = window.location.hash.slice(1) || 'dashboard';
                this.navigate(hash, false);
            }

            navigate(route, pushState = true) {
                if (!this.routes[route]) return;

                // Check authentication for protected routes
                const protectedRoutes = ['journal', 'dashboard', 'analytics', 'tools', 'psychology', 'playbook'];
                if (protectedRoutes.includes(route) && !authManager.requireAuth()) {
                    return;
                }

                // Check subscription access for premium features
                const premiumRoutes = ['analytics', 'tools', 'psychology', 'playbook'];
                if (premiumRoutes.includes(route) && !subscriptionManager.hasFeatureAccess(route)) {
                    alert(`This feature requires a ${route === 'psychology' || route === 'playbook' ? 'Team' : 'Pro'} subscription. Please upgrade your plan.`);
                    this.navigate('payments');
                    return;
                }

                // Hide all content
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Show target content
                document.getElementById(this.routes[route]).classList.remove('hidden');

                // Update navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active', 'bg-indigo-600', 'text-white');
                    link.classList.add('text-gray-300');
                });

                const activeLink = document.querySelector(`[data-route="${route}"]`);
                if (activeLink) {
                    activeLink.classList.add('active', 'bg-indigo-600', 'text-white');
                    activeLink.classList.remove('text-gray-300');
                }

                // Update page title
                const titles = {
                    'dashboard': 'Dashboard',
                    'journal': 'Trading Journal',
                    'analytics': 'Analytics',
                    'tools': 'Trading Tools',
                    'psychology': 'Trading Psychology',
                    'playbook': 'Trading Playbook',
                    'settings': 'Settings',
                    'payments': 'Payments'
                };
                document.getElementById('page-title').textContent = titles[route];

                // Update URL
                if (pushState) {
                    history.pushState({ route }, '', `#${route}`);
                }

                this.currentRoute = route;
            }
        }

        // Sidebar Toggle
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // Authentication Event Handlers
        document.getElementById('login-form-element').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            try {
                document.getElementById('login-error').classList.add('hidden');
                await authManager.login(email, password);
            } catch (error) {
                document.getElementById('login-error').textContent = error.message;
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        document.getElementById('signup-form-element').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const email = formData.get('email');
            const password = formData.get('password');
            
            try {
                document.getElementById('signup-error').classList.add('hidden');
                await authManager.signup(name, email, password);
            } catch (error) {
                document.getElementById('signup-error').textContent = error.message;
                document.getElementById('signup-error').classList.remove('hidden');
            }
        });

        document.getElementById('google-login-btn').addEventListener('click', async () => {
            try {
                await authManager.loginWithGoogle();
            } catch (error) {
                document.getElementById('login-error').textContent = error.message;
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        document.getElementById('show-signup-btn').addEventListener('click', () => {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        });

        document.getElementById('show-login-btn').addEventListener('click', () => {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                authManager.logout();
            }
        });

        // Payment event handlers
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize payments page when loaded
            if (authManager.isAuthenticated) {
                updatePaymentsPage();
                subscriptionManager.updateFeatureAccess();
            }

            // Cancel subscription handler
            document.getElementById('cancel-subscription-btn')?.addEventListener('click', () => {
                if (confirm('Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period.')) {
                    subscriptionManager.upgradePlan('free');
                    updatePaymentsPage();
                    alert('Subscription cancelled successfully.');
                }
            });
        });

        // Psychology Functions
        let habits = [];
        let moodEntries = [];
        let tiltAlertDismissed = false;

        // Mood slider functionality
        document.getElementById('mood-slider').addEventListener('input', (e) => {
            document.getElementById('mood-value').textContent = e.target.value;
        });

        async function saveMoodEntry() {
            const mood = parseInt(document.getElementById('mood-slider').value);
            const notes = document.getElementById('mood-notes').value;
            const today = new Date().toISOString().split('T')[0];

            try {
                await tradeDB.addMoodEntry({ mood, notes, date: today });
                document.getElementById('mood-notes').value = '';
                await loadMoodHistory();
                alert('Mood entry saved successfully!');
            } catch (error) {
                console.error('Error saving mood entry:', error);
                alert('Error saving mood entry');
            }
        }

        async function loadMoodHistory() {
            try {
                moodEntries = await tradeDB.getAllMoodEntries();
                renderMoodHistory();
            } catch (error) {
                console.error('Error loading mood entries:', error);
            }
        }

        function renderMoodHistory() {
            const container = document.getElementById('mood-history');
            
            if (moodEntries.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <p>No mood entries yet</p>
                        <p class="text-sm mt-1">Start tracking your daily mood above</p>
                    </div>
                `;
                return;
            }

            const entriesHtml = moodEntries
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10)
                .map(entry => {
                    const moodEmoji = entry.mood >= 8 ? 'üòä' : entry.mood >= 6 ? 'üòê' : entry.mood >= 4 ? 'üòï' : 'üòû';
                    return `
                        <div class="bg-dark-700 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-400">${new Date(entry.date).toLocaleDateString()}</span>
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${moodEmoji}</span>
                                    <span class="text-indigo-400 font-semibold">${entry.mood}/10</span>
                                </div>
                            </div>
                            ${entry.notes ? `<p class="text-gray-300 text-sm">${entry.notes}</p>` : ''}
                        </div>
                    `;
                }).join('');

            container.innerHTML = entriesHtml;
        }

        // Habit tracking functions
        function showAddHabitForm() {
            document.getElementById('add-habit-form').classList.remove('hidden');
            document.getElementById('new-habit-input').focus();
        }

        function cancelAddHabit() {
            document.getElementById('add-habit-form').classList.add('hidden');
            document.getElementById('new-habit-input').value = '';
        }

        async function addHabit() {
            const habitName = document.getElementById('new-habit-input').value.trim();
            if (!habitName) return;

            try {
                await tradeDB.addHabit({ name: habitName });
                document.getElementById('new-habit-input').value = '';
                document.getElementById('add-habit-form').classList.add('hidden');
                await loadHabits();
            } catch (error) {
                console.error('Error adding habit:', error);
                alert('Error adding habit');
            }
        }

        async function loadHabits() {
            try {
                habits = await tradeDB.getAllHabits();
                await renderHabits();
            } catch (error) {
                console.error('Error loading habits:', error);
            }
        }

        async function renderHabits() {
            const container = document.getElementById('habits-list');
            const today = new Date().toISOString().split('T')[0];
            
            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <p>No habits added yet</p>
                        <p class="text-sm mt-1">Click "Add Habit" to start tracking</p>
                    </div>
                `;
                return;
            }

            const todayEntries = await tradeDB.getHabitEntriesForDate(today);
            
            const habitsHtml = habits.map(habit => {
                const isCompleted = todayEntries.some(entry => entry.habitId === habit.id);
                return `
                    <div class="flex items-center justify-between bg-dark-700 rounded-lg p-3">
                        <span class="text-gray-300">${habit.name}</span>
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" ${isCompleted ? 'checked' : ''} 
                                   onchange="toggleHabit(${habit.id}, this.checked)"
                                   class="w-4 h-4 text-indigo-600 bg-dark-600 border-dark-500 rounded focus:ring-indigo-500">
                            <button onclick="deleteHabit(${habit.id})" class="text-red-400 hover:text-red-300 text-sm">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = habitsHtml;
        }

        async function toggleHabit(habitId, completed) {
            const today = new Date().toISOString().split('T')[0];
            
            try {
                if (completed) {
                    await tradeDB.addHabitEntry({ habitId, date: today });
                } else {
                    await tradeDB.deleteHabitEntry(habitId, today);
                }
            } catch (error) {
                console.error('Error toggling habit:', error);
            }
        }

        async function deleteHabit(habitId) {
            if (!confirm('Are you sure you want to delete this habit?')) return;
            
            try {
                await tradeDB.deleteHabit(habitId);
                await loadHabits();
            } catch (error) {
                console.error('Error deleting habit:', error);
                alert('Error deleting habit');
            }
        }

        // Tilt detection
        function checkForTilt() {
            if (tiltAlertDismissed) return;
            
            const recentTrades = trades.slice(-5); // Check last 5 trades
            let consecutiveLosses = 0;
            
            for (let i = recentTrades.length - 1; i >= 0; i--) {
                const pnl = calculatePnL(recentTrades[i]);
                if (pnl < 0) {
                    consecutiveLosses++;
                } else {
                    break;
                }
            }
            
            if (consecutiveLosses >= 3) {
                document.getElementById('tilt-alert').classList.remove('hidden');
            }
        }

        function dismissTiltAlert() {
            document.getElementById('tilt-alert').classList.add('hidden');
            tiltAlertDismissed = true;
            // Reset after 1 hour
            setTimeout(() => { tiltAlertDismissed = false; }, 3600000);
        }

        // Playbook Functions
        let setups = [];

        function showAddSetupForm() {
            document.getElementById('setup-form').classList.remove('hidden');
        }

        function cancelSetupForm() {
            document.getElementById('setup-form').classList.add('hidden');
            document.getElementById('setup-form-element').reset();
        }

        async function loadSetups() {
            try {
                setups = await tradeDB.getAllSetups();
                renderSetups();
            } catch (error) {
                console.error('Error loading setups:', error);
            }
        }

        function renderSetups() {
            const container = document.getElementById('setups-grid');
            
            if (setups.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-400 col-span-full">
                        <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                        </svg>
                        <p>No setups created yet</p>
                        <p class="text-sm mt-1">Click "Add Setup" to create your first trading setup</p>
                    </div>
                `;
                return;
            }

            const setupsHtml = setups.map(setup => `
                <div class="bg-dark-800 rounded-xl p-6 border border-dark-700">
                    ${setup.image ? `<img src="${setup.image}" alt="${setup.title}" class="w-full h-32 object-cover rounded-lg mb-4">` : ''}
                    <h3 class="text-lg font-semibold mb-2">${setup.title}</h3>
                    <p class="text-gray-400 text-sm mb-4 line-clamp-3">${setup.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${new Date(setup.createdAt).toLocaleDateString()}</span>
                        <button onclick="deleteSetup(${setup.id})" class="text-red-400 hover:text-red-300 text-sm">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = setupsHtml;
        }

        async function deleteSetup(setupId) {
            if (!confirm('Are you sure you want to delete this setup?')) return;
            
            try {
                await tradeDB.deleteSetup(setupId);
                await loadSetups();
            } catch (error) {
                console.error('Error deleting setup:', error);
                alert('Error deleting setup');
            }
        }

        // Setup form handler
        document.getElementById('setup-form-element').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const setup = {
                title: formData.get('title'),
                description: formData.get('description')
            };

            // Handle image upload
            const imageFile = formData.get('image');
            if (imageFile && imageFile.size > 0) {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    setup.image = e.target.result;
                    await saveSetup(setup);
                };
                reader.readAsDataURL(imageFile);
            } else {
                await saveSetup(setup);
            }
        });

        async function saveSetup(setup) {
            try {
                await tradeDB.addSetup(setup);
                document.getElementById('setup-form').classList.add('hidden');
                document.getElementById('setup-form-element').reset();
                await loadSetups();
                alert('Setup saved successfully!');
            } catch (error) {
                console.error('Error saving setup:', error);
                alert('Error saving setup');
            }
        }

        // Settings Functions
        async function loadSettings() {
            try {
                const accountSize = await tradeDB.getSetting('accountSize') || 10000;
                const baseCurrency = await tradeDB.getSetting('baseCurrency') || 'USD';
                const defaultRisk = await tradeDB.getSetting('defaultRisk') || 2;
                const timezone = await tradeDB.getSetting('timezone') || 'UTC';

                const form = document.getElementById('settings-form');
                form.accountSize.value = accountSize;
                form.baseCurrency.value = baseCurrency;
                form.defaultRisk.value = defaultRisk;
                form.timezone.value = timezone;

                // Update tools with saved settings
                document.getElementById('account-balance').value = accountSize;
                document.getElementById('risk-percentage').value = defaultRisk;
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            try {
                await tradeDB.saveSetting('accountSize', parseFloat(formData.get('accountSize')));
                await tradeDB.saveSetting('baseCurrency', formData.get('baseCurrency'));
                await tradeDB.saveSetting('defaultRisk', parseFloat(formData.get('defaultRisk')));
                await tradeDB.saveSetting('timezone', formData.get('timezone'));
                
                alert('Settings saved successfully!');
                await loadSettings(); // Refresh tools with new settings
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Error saving settings');
            }
        });

        // Data Export/Import Functions
        async function exportData(format) {
            try {
                const data = {
                    trades: await tradeDB.getAllTrades(),
                    moodEntries: await tradeDB.getAllMoodEntries(),
                    habits: await tradeDB.getAllHabits(),
                    setups: await tradeDB.getAllSetups(),
                    exportDate: new Date().toISOString()
                };

                let content, filename, mimeType;

                if (format === 'json') {
                    content = JSON.stringify(data, null, 2);
                    filename = `edgemetrics-${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json';
                } else if (format === 'csv') {
                    content = convertToCSV(data.trades);
                    filename = `edgemetrics-trades-${new Date().toISOString().split('T')[0]}.csv`;
                    mimeType = 'text/csv';
                } else if (format === 'xlsx') {
                    // For XLSX, we'll use a simple CSV format for now
                    content = convertToCSV(data.trades);
                    filename = `edgemetrics-trades-${new Date().toISOString().split('T')[0]}.xlsx`;
                    mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                }

                downloadFile(content, filename, mimeType);
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Error exporting data');
            }
        }

        function convertToCSV(trades) {
            if (trades.length === 0) return 'No trades to export';
            
            const headers = ['Date', 'Instrument', 'Entry', 'Exit', 'Stop Loss', 'Take Profit', 'Lot Size', 'Account', 'P&L', 'Tags', 'Notes'];
            const rows = trades.map(trade => [
                new Date(trade.date).toLocaleDateString(),
                trade.instrument,
                trade.entry,
                trade.exit || '',
                trade.stopLoss || '',
                trade.takeProfit || '',
                trade.lotSize,
                trade.account,
                calculatePnL(trade).toFixed(2),
                trade.tags || '',
                trade.notes || ''
            ]);

            return [headers, ...rows].map(row => 
                row.map(field => `"${String(field).replace(/"/g, '""')}"`).join(',')
            ).join('\n');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function importData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }

            try {
                const text = await file.text();
                let data;

                if (file.name.endsWith('.json')) {
                    data = JSON.parse(text);
                    if (data.trades) {
                        for (const trade of data.trades) {
                            delete trade.id; // Let DB assign new IDs
                            await tradeDB.addTrade(trade);
                        }
                    }
                } else if (file.name.endsWith('.csv')) {
                    const lines = text.split('\n');
                    const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (!lines[i].trim()) continue;
                        
                        const values = lines[i].split(',').map(v => v.replace(/"/g, ''));
                        const trade = {
                            instrument: values[1],
                            entry: parseFloat(values[2]),
                            exit: values[3] ? parseFloat(values[3]) : null,
                            stopLoss: values[4] ? parseFloat(values[4]) : null,
                            takeProfit: values[5] ? parseFloat(values[5]) : null,
                            lotSize: parseFloat(values[6]),
                            account: values[7],
                            tags: values[9],
                            notes: values[10]
                        };
                        
                        await tradeDB.addTrade(trade);
                    }
                }

                await loadTrades();
                alert('Data imported successfully!');
                fileInput.value = '';
            } catch (error) {
                console.error('Error importing data:', error);
                alert('Error importing data. Please check the file format.');
            }
        }

        async function createBackup() {
            try {
                const data = {
                    trades: await tradeDB.getAllTrades(),
                    moodEntries: await tradeDB.getAllMoodEntries(),
                    habits: await tradeDB.getAllHabits(),
                    setups: await tradeDB.getAllSetups(),
                    settings: {
                        accountSize: await tradeDB.getSetting('accountSize'),
                        baseCurrency: await tradeDB.getSetting('baseCurrency'),
                        defaultRisk: await tradeDB.getSetting('defaultRisk'),
                        timezone: await tradeDB.getSetting('timezone')
                    },
                    backupDate: new Date().toISOString()
                };

                // Simple encryption (base64 encoding for demo)
                const encrypted = btoa(JSON.stringify(data));
                const filename = `edgemetrics-backup-${new Date().toISOString().split('T')[0]}.emb`;
                
                downloadFile(encrypted, filename, 'application/octet-stream');
                alert('Encrypted backup created successfully!');
            } catch (error) {
                console.error('Error creating backup:', error);
                alert('Error creating backup');
            }
        }

        async function restoreBackup() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.emb';
            
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const encrypted = await file.text();
                    const decrypted = atob(encrypted);
                    const data = JSON.parse(decrypted);

                    if (confirm('This will replace all current data. Are you sure?')) {
                        // Clear existing data and restore
                        if (data.trades) {
                            for (const trade of data.trades) {
                                delete trade.id;
                                await tradeDB.addTrade(trade);
                            }
                        }
                        
                        if (data.settings) {
                            for (const [key, value] of Object.entries(data.settings)) {
                                if (value !== undefined) {
                                    await tradeDB.saveSetting(key, value);
                                }
                            }
                        }

                        await loadTrades();
                        await loadSettings();
                        alert('Backup restored successfully!');
                    }
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    alert('Error restoring backup. Please check the file.');
                }
            };

            fileInput.click();
        }

        // Initialize Lucide Icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // Initialize Router
        const router = new Router();

        // Initialize data when authenticated
        const tradeDB = new TradeDB();

        // Modal System
        function showModal(title, content, actions = []) {
            const modal = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white">${title}</h3>
                    <button onclick="hideModal()" class="p-1 rounded-lg hover:bg-charcoal-700/50 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-charcoal-400"></i>
                    </button>
                </div>
                <div class="text-charcoal-300 mb-6">${content}</div>
                <div class="flex justify-end space-x-3">
                    ${actions.map(action => `
                        <button onclick="${action.onClick}" class="${action.class || 'btn-primary'} px-4 py-2 rounded-xl font-medium transition-all">
                            ${action.text}
                        </button>
                    `).join('')}
                </div>
            `;
            
            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function hideModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        // Toast System
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500/20 border-green-500/30 text-green-400',
                error: 'bg-red-500/20 border-red-500/30 text-red-400',
                warning: 'bg-yellow-500/20 border-yellow-500/30 text-yellow-400',
                info: 'bg-blue-500/20 border-blue-500/30 text-blue-400'
            };
            
            toast.className = `glass rounded-xl p-4 border ${colors[type]} animate-slide-down will-change-transform`;
            toast.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            container.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease-out forwards';
                setTimeout(() => container.removeChild(toast), 300);
            }, duration);
        }

        // Enhanced delete confirmation
        async function confirmDelete(itemName, deleteFunction) {
            return new Promise((resolve) => {
                showModal(
                    'Confirm Deletion',
                    `Are you sure you want to delete "${itemName}"? This action cannot be undone.`,
                    [
                        {
                            text: 'Cancel',
                            class: 'bg-charcoal-600 hover:bg-charcoal-700 text-white',
                            onClick: 'hideModal(); resolve(false);'
                        },
                        {
                            text: 'Delete',
                            class: 'bg-red-600 hover:bg-red-700 text-white',
                            onClick: `hideModal(); ${deleteFunction}; resolve(true);`
                        }
                    ]
                );
                
                // Store resolve function globally for button access
                window.modalResolve = resolve;
            });
        }

        // Notification System
        class NotificationManager {
            constructor() {
                this.notifications = JSON.parse(localStorage.getItem('edgeMetrics_notifications') || '[]');
                this.init();
            }

            init() {
                this.updateBadge();
                
                // Add notification button event listener
                document.getElementById('notifications-btn').addEventListener('click', () => {
                    this.showNotifications();
                });
            }

            addNotification(title, message, type = 'info') {
                const notification = {
                    id: Date.now(),
                    title,
                    message,
                    type,
                    timestamp: new Date().toISOString(),
                    read: false
                };

                this.notifications.unshift(notification);
                this.saveNotifications();
                this.updateBadge();
                
                // Show toast for new notification
                showToast(title, type, 4000);
            }

            markAsRead(id) {
                const notification = this.notifications.find(n => n.id === id);
                if (notification) {
                    notification.read = true;
                    this.saveNotifications();
                    this.updateBadge();
                }
            }

            markAllAsRead() {
                this.notifications.forEach(n => n.read = true);
                this.saveNotifications();
                this.updateBadge();
            }

            deleteNotification(id) {
                this.notifications = this.notifications.filter(n => n.id !== id);
                this.saveNotifications();
                this.updateBadge();
            }

            clearAll() {
                this.notifications = [];
                this.saveNotifications();
                this.updateBadge();
            }

            updateBadge() {
                const unreadCount = this.notifications.filter(n => !n.read).length;
                const badge = document.getElementById('notification-badge');
                
                if (unreadCount > 0) {
                    badge.classList.remove('hidden');
                    badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                } else {
                    badge.classList.add('hidden');
                }
            }

            showNotifications() {
                const notificationsHtml = this.notifications.length === 0 ? 
                    '<div class="text-center py-8 text-charcoal-400">No notifications yet</div>' :
                    this.notifications.map(notification => {
                        const typeColors = {
                            success: 'text-green-400 border-green-500/20',
                            error: 'text-red-400 border-red-500/20',
                            warning: 'text-yellow-400 border-yellow-500/20',
                            info: 'text-blue-400 border-blue-500/20'
                        };
                        
                        const typeIcons = {
                            success: 'check-circle',
                            error: 'x-circle',
                            warning: 'alert-triangle',
                            info: 'info'
                        };

                        return `
                            <div class="glass rounded-xl p-4 border ${typeColors[notification.type]} ${notification.read ? 'opacity-60' : ''} mb-3">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-3 flex-1">
                                        <i data-lucide="${typeIcons[notification.type]}" class="w-5 h-5 ${typeColors[notification.type].split(' ')[0]} mt-0.5"></i>
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-white mb-1">${notification.title}</h4>
                                            <p class="text-sm text-charcoal-300 mb-2">${notification.message}</p>
                                            <span class="text-xs text-charcoal-400">${new Date(notification.timestamp).toLocaleString()}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-3">
                                        ${!notification.read ? `<button onclick="notificationManager.markAsRead(${notification.id}); this.closest('.glass').classList.add('opacity-60')" class="text-charcoal-400 hover:text-white text-xs">Mark Read</button>` : ''}
                                        <button onclick="notificationManager.deleteNotification(${notification.id}); this.closest('.glass').remove()" class="text-red-400 hover:text-red-300">
                                            <i data-lucide="x" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                const actions = this.notifications.length > 0 ? [
                    {
                        text: 'Mark All Read',
                        class: 'bg-charcoal-600 hover:bg-charcoal-700 text-white',
                        onClick: 'notificationManager.markAllAsRead(); hideModal();'
                    },
                    {
                        text: 'Clear All',
                        class: 'bg-red-600 hover:bg-red-700 text-white',
                        onClick: 'notificationManager.clearAll(); hideModal();'
                    }
                ] : [];

                showModal('Notifications', `<div class="max-h-96 overflow-y-auto">${notificationsHtml}</div>`, actions);
            }

            saveNotifications() {
                localStorage.setItem('edgeMetrics_notifications', JSON.stringify(this.notifications));
            }

            // Auto-generate notifications based on trading activity
            checkTradingMilestones(trades) {
                const totalTrades = trades.length;
                const milestones = [1, 5, 10, 25, 50, 100];
                
                milestones.forEach(milestone => {
                    const key = `milestone_${milestone}`;
                    if (totalTrades === milestone && !localStorage.getItem(`edgeMetrics_${key}`)) {
                        this.addNotification(
                            'üéâ Trading Milestone!',
                            `Congratulations! You've completed ${milestone} trade${milestone > 1 ? 's' : ''}!`,
                            'success'
                        );
                        localStorage.setItem(`edgeMetrics_${key}`, 'true');
                    }
                });

                // Win streak notifications
                const recentTrades = trades.slice(-5);
                let winStreak = 0;
                for (let i = recentTrades.length - 1; i >= 0; i--) {
                    if (calculatePnL(recentTrades[i]) > 0) {
                        winStreak++;
                    } else {
                        break;
                    }
                }

                if (winStreak >= 3 && !localStorage.getItem('edgeMetrics_winstreak_3')) {
                    this.addNotification(
                        'üî• Win Streak!',
                        `Amazing! You're on a ${winStreak} trade winning streak!`,
                        'success'
                    );
                    localStorage.setItem('edgeMetrics_winstreak_3', 'true');
                    setTimeout(() => localStorage.removeItem('edgeMetrics_winstreak_3'), 24 * 60 * 60 * 1000);
                }
            }
        }

        // Initialize notification manager
        let notificationManager;

        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', async () => {
            lucide.createIcons();
            
            if (authManager.isAuthenticated) {
                await tradeDB.init();
                await loadTrades();
                await loadSettings();
                await loadMoodHistory();
                await loadHabits();
                await loadSetups();
                
                // Initialize notifications
                notificationManager = new NotificationManager();
                
                // Welcome notification for new users
                if (trades.length === 0) {
                    notificationManager.addNotification(
                        'Welcome to EdgeMetrics!',
                        'Start by adding your first trade in the Journal section.',
                        'info'
                    );
                }
            }
        });

        // Override the existing loadTrades function to include tilt check and notifications
        const originalLoadTrades = loadTrades;
        loadTrades = async function() {
            await originalLoadTrades();
            checkForTilt();
            
            // Check for trading milestones if notification manager is available
            if (notificationManager && trades.length > 0) {
                notificationManager.checkTradingMilestones(trades);
            }
        };

        // Close sidebar on mobile when clicking a link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 1024) {
                    toggleSidebar();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e995a3c59473fa',t:'MTc1Nzc4Njg1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
